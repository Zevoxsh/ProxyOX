global:
  log-level: info
  use-uvloop: false
  timeout: 300
  max-connections: 100
  rate-limit: 1000  # Max requêtes/connexions par seconde par proxy

frontends:
  # Port 80 - Reverse proxy HTTP avec routage par nom de domaine
  - name: http-reverse-proxy
    bind: 0.0.0.0:80
    mode: http
    domain_routes:
      - domain: app.example.com
        backend: app-server
      - domain: api.example.com
        backend: api-server
      - domain: blog.example.com
        backend: blog-server
    # Backend par défaut si aucun domaine ne correspond
    default_backend: app-server

  # Port 443 - Reverse proxy HTTPS avec routage par nom de domaine (SNI)
  - name: https-reverse-proxy
    bind: 0.0.0.0:443
    mode: http
    domain_routes:
      - domain: app.example.com
        backend: app-server-https
      - domain: api.example.com
        backend: api-server-https
      - domain: blog.example.com
        backend: blog-server-https
    default_backend: app-server-https

  # Port 8080 - TCP proxy direct (accès direct si besoin)
  - name: tcp-direct
    bind: 0.0.0.0:8080
    mode: tcp
    default_backend: app-server
    backend_ssl: false

backends:
  # Backends HTTP (port 80)
  - name: app-server
    server: 192.168.1.10:80
    https: false

  - name: api-server
    server: 192.168.1.20:8080
    https: false

  - name: blog-server
    server: 192.168.1.30:3000
    https: false

  # Backends HTTPS (port 443)
  - name: app-server-https
    server: 192.168.1.10:443
    https: true

  - name: api-server-https
    server: 192.168.1.20:8443
    https: true

  - name: blog-server-https
    server: 192.168.1.30:3443
    https: true